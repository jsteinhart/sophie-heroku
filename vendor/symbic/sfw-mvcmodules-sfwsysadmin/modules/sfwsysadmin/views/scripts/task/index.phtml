<?php
$module = 'sfwsysadmin';
$this->headLink()->appendStylesheet($this->sfwModuleAssetUrl('module.css', $module));
$this->inlineScript()->appendFile($this->sfwModuleAssetUrl('module.js', $module));

$this->headTitle('System Administration', 'PREPEND');
$this->headTitle('Tasks', 'PREPEND');
?>
<h1>Task List</h1>
<div class="table-responsive">
<table id="taskList" class="table table-striped table-hover">
<thead>
<tr>
	<th><?php echo $this->T('Name'); ?></th>
	<th><?php echo $this->T('Last Creation'); ?></th>
	<th><?php echo $this->T('Last Start'); ?></th>
	<th><?php echo $this->T('Last Finish'); ?></th>
	<th><?php echo $this->T('Status'); ?></th>
	<th><?php echo $this->T('Options'); ?></th>
</tr>
</thead>
<tbody>
<?php foreach ($this->tasks as $task):
	if (!$task['valid']):
		continue;
	endif;
?>
<tr>
	<td>
		<?php
		if (!empty($task['description'])):
			echo '<span class="sfwsysadminTaskHasDescription" title="' . $this->escape($task['description']) . '">';
			echo $this->escape($task['name']);
			echo '</span>';
		else:
			echo $this->escape($task['name']);
		endif;
		?>
	</td>
	<?php foreach (array('maxCreationDateTS', 'maxStartDateTS', 'maxFinishDateTS') as $key): ?>
	<td>
		<?php
			echo (empty($task[$key]))
				? '&ndash;'
				: date('Y-m-d H:i:s', $task[ $key ]);
		?>
	</td>
	<?php endforeach; ?>
	<td>
		<?php
			foreach ($task['log'] as $log):
				$img = '../Icons.inactive/help.png';
				$alt = 'Unknown';
				switch ($log['type']):
					case 'message':
						$img = 'comment.png';
						$img = 'email.png';
						$alt = 'Message';
						break;
					case 'notice':
						$img = 'information.png';
						$alt = 'Notice';
						break;
					case 'warning':
						$img = 'error.png';
						$alt = 'Warning';
						break;
					case 'error':
						$img = 'exclamation.png';
						$alt = 'Error';
						break;
					case 'exception':
						$img = 'exclamation.png';
						$alt = 'Exception';
						break;
				endswitch;
				echo '<img src="/_media/Icons/' . $img . '" alt="' . $this->escape($this->T($alt)) . '" title="' . $this->escape($this->T($alt)) . '" />' . PHP_EOL;
			endforeach;
		?>
	</td>
	<td>
<?php
		echo $this->buttonLink('<img src="/_media/Icons/book.png" alt="' . $this->escape($this->T('History')) . '" title="' . $this->escape($this->T('History')) . '" />', $this->url(array(
				'action' => 'history',
				'task' => $task['task'],
			), 'default', false), null, 'xs');

		if ($task['manuallyQueueable'])
		{
			echo $this->buttonLink('<img src="/_media/Icons/control_play_blue.png" alt="' . $this->escape($this->T('Queue manually')) . '" title="' . $this->escape($this->T('Queue manually')) . '" />', $this->url(array(
				'action' => 'queue',
				'task' => $task['task'],
			), 'default', false), null, 'xs');
		}
		else
		{
			echo $this->buttonLink('<img src="/_media/Icons.inactive/control_play_blue.png" alt="' . $this->escape($this->T('Queue manually (disabled)')) . '" title="' . $this->escape($this->T('Queue manually (disabled)')) . '" />', '#', null, 'xs');
		}
?>
	</td>
</tr>
<?php
endforeach;
?>

</tbody>
</table>
</div>